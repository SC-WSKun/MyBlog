---
title: Webpack打包优化
date: 2022-01-16 10:20:32
tags: 打包
categories: Web开发 
---

# 为什么要进行打包优化

- 当项目越来越大，越来越复杂的时候，依赖包会越来越多，打包的文件会变得很大
- 单页面应用首页白屏时间长，用户体验差（因为在首页就要加载除了首页显示的组件之外的其它路由对应的组件）

# Webpack的几种优化

## 构建优化

1. 优化loader配置

   - 优化正则匹配

   - 将Babel编译过的文件进行缓存，只编译被更改过的代码文件。

   - 通过include、exclude来规定文件搜索范围

   - 合理使用resolve字段配置（其实就是减少递归查找的过程）

     {% note info %}

     - resolve.modules会告诉webpack第三方模块的目录，不需要递归查找
     - resolve.alias可以使webpack直接使用库的min文件，不需要解析映射
     - resolve.extensions可以规定文件后缀列表，当没有规定后缀名时，会默认按[js,json]的查找顺序查找文件

     {% endnote %}

   - 提前构建第三方库

3. 并行构建，Webpack打包的时候是**单线程**的，所以引入了HappyPack和ThreadLoader，使之可以同时执行多个**进程**
4. HMR模块热替换：当一个模块发生改变时，只会打包这一个模块

## 压缩优化

1. 删除冗余代码
2. 压缩代码（html去掉空格和注释）
3. 代码分割实现按需加载
   - 路由组件按需加载
   - 按需引入第三方组件（比如有的页面直接引入vant全部组件，但是并没有全部用到）
   - 在组件中按需引入，而不是在main.js中引入
4. Scope Hoisting：作用域提升，将打散的模块合并在一个函数中

## 运行速度优化

1. 通过cacheDirectory选项开启缓存，对构建路径下的文件都设置cookie实现强缓存。
2. 预加载（区别与预加载），在主页面加载完之后，再“偷偷”地进行异步加载。懒加载需要事件进行触发
